define("components/w69b-es6/mic-level-factory.js",["exports","./webrtc.js","./audio-context-pool.js","./log.js","./q.js"],function(e,n,t,r,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function o(){function e(e){return function(){var n=arguments,t=f.default.defer();return(v||f.default.when()).finally(function(){var r=e.apply(null,n);t.resolve(r)}),v=t.promise,v.finally(function(){v=null}),t.promise}}function n(){var e=m.analyser;e&&(o||(o=new Uint8Array(e.frequencyBinCount)),e.getByteFrequencyData(o),g=-1)}function t(){g=Math.max.apply(null,o)/255}function r(e){if(p)throw Error();s=e,p=c.default.acquire();var t=p,r=t.createMediaStreamSource(e),a=t.createAnalyser(),i=t.createGain();i.gain.value=w,a.smoothingTimeConstant=.3,a.fftSize=32,a.minDecibels=-70,a.maxDecibels=-10;var o=t.createScriptProcessor(2048,2,1);o.onaudioprocess=n,r.connect(i),i.connect(a),a.connect(o),o.connect(t.destination),m.input=r,m.analyser=a,m.capture=o,m.gain=i}function a(){if(l.default.debug("micLevelFactory: getting new stream"),S)throw new Error;var e={};return d&&(e.sourceId=d),u.default.getUserMedia({audio:{mandatory:e},video:!1})}function i(){s&&!S&&(s.getTracks().forEach(function(e){e.stop()}),s=null)}var o,s,d,p,v,y={},m={},g=0,S=!1,h=0,w=1;return y.start=e(function(){var e=null;return h||(s?r(s):e=a().then(r)),++h,e}),y.setGain=function(e){w=e,m.gain&&(m.gain.gain.value=e)},y.setSourceId=e(function(e){if(d=e,i(),m.input)return a().then(function(e){s=e,m.input.disconnect(),m.input=p.createMediaStreamSource(e),m.input.connect(m.gain)})}),y.setSourceStream=e(function(e){S=!0,s=e,m.input&&(m.input.disconnect(),m.input=p.createMediaStreamSource(e),m.input.connect(m.gain))}),y.stop=e(function(){if(h&&!--h){var e=!0,n=!1,t=void 0;try{for(var r,a=Object.values(m)[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var o=r.value;o.disconnect()}}catch(e){n=!0,t=e}finally{try{!e&&a.return&&a.return()}finally{if(n)throw t}}m={},i(),g=0,c.default.release(p),p=null}}),y.getVolume=function(){return g<0&&t(),g},y}Object.defineProperty(e,"__esModule",{value:!0});var u=i(n),c=i(t),l=i(r),f=i(a);e.default=o});
//# sourceURL=https://www.cam-recorder.com/elements/wb-cam-app.32cca2d4.html-70.js
